<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>さじグラム</title>
  <style>
    /* Rosé Pine Dawn */
    :root {
      --base:    #faf4ed;
      --surface: #fffaf3;
      --overlay: #f2e9e1;
      --muted:   #9893a5;
      --subtle:  #797593;
      --text:    #575279;
      --love:    #b4637a;
      --gold:    #ea9d34;
      --rose:    #d7827a;
      --hl-low:  #f4ede8;
      --hl-med:  #dfdad9;
      --hl-high: #cecacd;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
      background: var(--base);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 20px 16px;
    }

    .container {
      width: 100%;
      max-width: 440px;
      background: var(--surface);
      border-radius: 20px;
      box-shadow: 0 2px 16px rgba(87, 82, 121, 0.08);
      overflow: hidden;
    }

    .input-section {
      padding: 28px 24px 24px;
    }

    h1 {
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--rose);
      margin-bottom: 24px;
      letter-spacing: 0.04em;
    }

    .field {
      margin-bottom: 20px;
    }

    .field-label {
      display: block;
      font-size: 0.68rem;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    /* トグル */
    .toggle-group {
      display: flex;
      gap: 8px;
    }

    .toggle-label {
      flex: 1;
      cursor: pointer;
    }

    .toggle-label input[type="radio"] {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 48px;
      border: 2px solid var(--hl-med);
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      color: var(--subtle);
      background: var(--overlay);
      transition: border-color 0.15s, background 0.15s, color 0.15s;
      user-select: none;
    }

    .toggle-label input[type="radio"]:checked + .toggle-btn {
      border-color: var(--love);
      background: rgba(180, 99, 122, 0.08);
      color: var(--love);
    }

    .toggle-label input[type="radio"]:focus-visible + .toggle-btn {
      outline: 2px solid var(--love);
      outline-offset: 2px;
    }

    /* セレクト */
    select {
      appearance: none;
      -webkit-appearance: none;
      background-color: var(--overlay);
      border: 2px solid var(--hl-med);
      border-radius: 10px;
      padding: 11px 32px 11px 12px;
      font-size: 1rem;
      font-family: inherit;
      color: var(--text);
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1.5l5 5 5-5' stroke='%239893a5' stroke-width='1.8' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      min-height: 48px;
      transition: border-color 0.15s;
    }

    select:focus {
      outline: none;
      border-color: var(--love);
    }

    select:disabled {
      opacity: 0.35;
      cursor: default;
    }

    /* 分量行 */
    .amount-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .amount-row .sep {
      color: var(--muted);
      font-size: 0.95rem;
      white-space: nowrap;
    }

    #integer     { width: 74px; }
    #numerator   { width: 74px; }
    #denominator { width: 74px; }
    #ingredient  { width: 100%; }

    /* 結果エリア */
    .result-section {
      padding: 22px 20px 24px;
      background: var(--hl-low);
      border-top: 2px solid var(--hl-med);
      text-align: center;
      min-height: 108px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .result-summary {
      font-size: 1rem;
      color: var(--subtle);
      font-weight: 500;
    }

    .result-grams {
      font-size: 2.8rem;
      font-weight: 800;
      color: var(--rose);
      letter-spacing: -0.02em;
      line-height: 1;
    }

    @media (max-width: 360px) {
      .amount-row { flex-wrap: wrap; gap: 4px; }
      #integer, #numerator, #denominator { width: 68px; }
    }

    /* 説明セクション */
    body {
      flex-direction: column;
      gap: 20px;
    }

    .description {
      width: 100%;
      max-width: 440px;
      padding: 0 4px;
    }

    .description h2 {
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.08em;
      margin-bottom: 6px;
    }

    .description p {
      font-size: 0.85rem;
      color: var(--subtle);
      line-height: 1.7;
    }

    .description a {
      color: var(--love);
      text-decoration: underline;
      text-underline-offset: 2px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="input-section">
      <h1>さじグラム</h1>

      <!-- さじ種別: 小さじ→大さじ、小さじデフォルト -->
      <div class="field">
        <span class="field-label">さじ種別</span>
        <div class="toggle-group" role="group" aria-label="さじ種別">
          <label class="toggle-label">
            <input type="radio" name="spoon" value="teaspoon" checked>
            <span class="toggle-btn">小さじ</span>
          </label>
          <label class="toggle-label">
            <input type="radio" name="spoon" value="tablespoon">
            <span class="toggle-btn">大さじ</span>
          </label>
        </div>
      </div>

      <!-- 分量 -->
      <div class="field">
        <span class="field-label">分量</span>
        <div class="amount-row">
          <select id="integer" aria-label="整数部"></select>
          <span class="sep">と</span>
          <select id="numerator" aria-label="端数の分子"></select>
          <span class="sep">/</span>
          <select id="denominator" aria-label="端数の分母"></select>
        </div>
      </div>

      <!-- 調味料 -->
      <div class="field">
        <label class="field-label" for="ingredient">調味料</label>
        <select id="ingredient"></select>
      </div>
    </div>

    <!-- 結果 -->
    <div class="result-section" aria-live="polite">
      <div class="result-summary" id="result-summary"></div>
      <div class="result-grams"   id="result-grams"></div>
    </div>
  </div>

  <div class="description">
    <h2>これはなに？</h2>
    <p>大さじと小さじを、グラムに変換する。<br>
    0.1g単位で3kgまで測れる<a href="https://amzn.to/4bdX1yK" target="_blank" rel="noopener">キッチンスケール</a>の上に、鍋・フライパンを置き、調味料を入れていくと便利。</p>
  </div>

  <script>
    const groups = [
      { gramPerTablespoon: 18, items: ["塩", "みりん", "しょうゆ"] },
      { gramPerTablespoon: 15, items: ["水", "酒", "酢"] },
      { gramPerTablespoon:  9, items: ["砂糖", "小麦粉", "片栗粉"] },
    ];

    // 調味料リストをフラットに展開（順番を保持）
    const ingredients = groups.flatMap((grp, gi) =>
      grp.items.map(name => ({ name, gramPerTablespoon: grp.gramPerTablespoon, group: gi }))
    );

    const integerSel     = document.getElementById("integer");
    const numeratorSel   = document.getElementById("numerator");
    const denominatorSel = document.getElementById("denominator");
    const ingredientSel  = document.getElementById("ingredient");
    const resultSummary  = document.getElementById("result-summary");
    const resultGrams    = document.getElementById("result-grams");

    // セレクト構築
    for (let i = 0; i <= 9; i++) {
      const opt = new Option(i, i);
      if (i === 1) opt.selected = true;
      integerSel.appendChild(opt);
    }
    for (let i = 0; i <= 5; i++) numeratorSel.appendChild(new Option(i, i));
    for (let i = 1; i <= 5; i++) denominatorSel.appendChild(new Option(i, i));

    // 調味料プルダウン（optgroupごと）
    const optgroups = groups.map(grp => {
      const og = document.createElement("optgroup");
      grp.items.forEach(name => {
        const idx = ingredients.findIndex(it => it.name === name);
        og.appendChild(new Option(name, idx));
      });
      ingredientSel.appendChild(og);
      return og;
    });

    function updateOptgroupLabels(isTable) {
      groups.forEach((grp, gi) => {
        const grams = isTable ? grp.gramPerTablespoon : parseFloat((grp.gramPerTablespoon / 3).toFixed(2));
        optgroups[gi].label = `${isTable ? "大さじ" : "小さじ"}1 = ${grams}g`;
      });
    }

    function syncDenominator() {
      denominatorSel.disabled = (parseInt(numeratorSel.value, 10) === 0);
    }

    function calculate() {
      const intPart    = parseInt(integerSel.value, 10);
      const num        = parseInt(numeratorSel.value, 10);
      const den        = parseInt(denominatorSel.value, 10);
      const isTable    = document.querySelector('input[name="spoon"]:checked').value === "tablespoon";
      updateOptgroupLabels(isTable);
      const ingredient = ingredients[parseInt(ingredientSel.value, 10)];
      const fraction   = num === 0 ? 0 : num / den;
      const amount     = intPart + fraction;
      const spoonCoef  = isTable ? 1 : (1 / 3);
      const grams      = parseFloat((amount * spoonCoef * ingredient.gramPerTablespoon).toFixed(2));

      let amountStr;
      if (num === 0) {
        amountStr = String(intPart);
      } else if (intPart === 0) {
        amountStr = `${num}/${den}`;
      } else {
        amountStr = `${intPart}と${num}/${den}`;
      }

      const spoonName = isTable ? "大さじ" : "小さじ";
      resultSummary.textContent = `${ingredient.name}　${spoonName}${amountStr}`;
      resultGrams.textContent   = `＝ ${grams}g`;
    }

    integerSel.addEventListener("change", calculate);
    numeratorSel.addEventListener("change", () => { syncDenominator(); calculate(); });
    denominatorSel.addEventListener("change", calculate);
    ingredientSel.addEventListener("change", calculate);
    document.querySelectorAll('input[name="spoon"]').forEach(r =>
      r.addEventListener("change", calculate)
    );

    syncDenominator();
    calculate();
  </script>
</body>
</html>
